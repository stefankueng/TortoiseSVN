<?xml version='1.0'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2003/01/wi'>
	<?include Includes.wxi?>
	<Product
		  UpgradeCode="$(var.UpgradeGuid)"
		Name="TortoiseOverlays"
		  Id="????????-????-????-????-????????????"
		  Version="$(var.VersionNumberInternal)"
		  Manufacturer="TortoiseSVN"
		  Language="1033">
		<Package
				Id="????????-????-????-????-????????????"
				Keywords="Tortoise,Overlays"
				Description="Overlayhandler for Tortoise clients"
				Comments="Provided by TortoiseSVN"
				Manufacturer="TortoiseSVN"
				InstallerVersion="200"
				Platforms="$(var.PackagePlatforms)"
				Languages="1033"
				Compressed="yes"
				SummaryCodepage="1252"/>

		<Media Id="1" Cabinet="TOVL.cab" EmbedCab="yes" CompressionLevel="high" />

		<Directory Id='TARGETDIR' Name='SourceDir'>
			<Directory Id='CommonFilesFolder' Name='Common'>
				<Directory Id='TortoioseOverlays' Name='TortOvl' LongName='TortoiseOverlays'>
					<Component Id="C__overlaydll" Guid="$(var.OverlayDll)" Win64="$(var.Win64YesNo)">
						<File Id="F__overlaydll" Name="TORTOVL.DLL" LongName="TortoiseOverlays.dll" DiskId="1" src="..\..\bin\$(var.ReleasePath)\bin\TortoiseOverlays.dll" KeyPath="yes" />
					</Component>

					<?include TortoiseOverlaysDir.wxi?>

					<Directory Id="D__icons" Name="ICONS" LongName="icons" >
						<Directory Id="D__iconsxpstyle" Name="XPStyle" >
							<Component Id="C__iconsxpstyle" Guid="$(var.GuidIconsXPStyle)" Win64="$(var.Win64YesNo)">
								<File Id="F__XPStyleConflictIcon" Name="TORTOI1.ICO" LongName="NormalIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\NormalIcon.ico" KeyPath="yes" />
								<File Id="F__XPStyleInSubversionIcon" Name="TORTOI2.ICO" LongName="ModifiedIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\ModifiedIcon.ico" />
								<File Id="F__XPStyleModifiedIcon" Name="TORTOI3.ICO" LongName="ConflictIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\ConflictIcon.ico" />
								<File Id="F__XPStyleReadOnlyIcon" Name="TORTOI4.ICO" LongName="DeletedIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\DeletedIcon.ico" />
								<File Id="F__XPStyleDeletedIcon" Name="TORTOI5.ICO" LongName="ReadOnlyIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\ReadOnlyIcon.ico" />
								<File Id="F__XPStyleLockedIcon" Name="TORTOI6.ICO" LongName="LockedIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\LockedIcon.ico" />
								<File Id="F__XPStyleAddedIcon" Name="TORTOI7.ICO" LongName="AddedIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\AddedIcon.ico" />
								<File Id="F__XPStyleIgnoredIcon" Name="TORTOI7.ICO" LongName="IgnoredIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\IgnoredIcon.ico" />
								<File Id="F__XPStyleUnversionedIcon" Name="TORTOI7.ICO" LongName="UnversionedIcon.ico" DiskId="1" src="..\Resources\Icons\XPStyle\UnversionedIcon.ico" />
							</Component>
						</Directory>
					</Directory>

				</Directory>
			</Directory>
		</Directory>

		<Feature Id='TortoiseOverlaysPackage' Title='TortoiseOverlays Package' Level='1'>
			<ComponentRef Id='C__overlaydll' />
			<ComponentRef Id='C__iconsxpstyle' />
			<ComponentRef Id='OverlayRegistry' />
			<ComponentRef Id='C__machineregistry' />
			<ComponentRef Id='C__approveshellcomponents' />
		</Feature>

		<InstallExecuteSequence>
			<!-- AppSearch must be done before RemoveExistingProducts and before FindRelatedProducts -->
			<AppSearch Sequence="1"></AppSearch>
			<RemoveExistingProducts After="InstallValidate">1</RemoveExistingProducts>
			<ScheduleReboot After="RegisterProduct" />
		</InstallExecuteSequence>

	</Product>
</Wix>