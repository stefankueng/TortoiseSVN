Index: include/Scintilla.h
===================================================================
--- include/Scintilla.h	(revision 28084)
+++ include/Scintilla.h	(working copy)
@@ -1104,6 +1104,8 @@
 #define SCN_AUTOCSELECTIONCHANGE 2032
 /* --Autogenerated -- end of section automatically generated from Scintilla.iface */
 
+#define SCN_GETBKCOLOR 5000
+
 /* These structures are defined to be exactly the same shape as the Win32
  * CHARRANGE, TEXTRANGE, FINDTEXTEX, FORMATRANGE, and NMHDR structs.
  * So older code that treats Scintilla as a RichEdit will work. */
Index: src/Editor.cxx
===================================================================
--- src/Editor.cxx	(revision 28084)
+++ src/Editor.cxx	(working copy)
@@ -103,6 +103,7 @@
 }
 
 Editor::Editor() {
+	view.editor = this;
 	ctrlID = 0;
 
 	stylesValid = false;
Index: src/Editor.h
===================================================================
--- src/Editor.h	(revision 28084)
+++ src/Editor.h	(working copy)
@@ -571,6 +571,7 @@
 	static sptr_t BytesResult(sptr_t lParam, const unsigned char *val, size_t len);
 
 public:
+	virtual void NotifyParent(SCNotification * scn) = 0;
 	// Public so the COM thunks can access it.
 	bool IsUnicodeMode() const;
 	// Public so scintilla_send_message can use it.
Index: src/EditView.cxx
===================================================================
--- src/EditView.cxx	(revision 28084)
+++ src/EditView.cxx	(working copy)
@@ -53,6 +53,7 @@
 #include "EditModel.h"
 #include "MarginView.h"
 #include "EditView.h"
+#include "Editor.h"
 
 using namespace Scintilla;
 
@@ -186,6 +187,7 @@
 	tabArrowHeight = 4;
 	customDrawTabArrow = NULL;
 	customDrawWrapMarker = NULL;
+	editor = NULL;
 }
 
 EditView::~EditView() {
@@ -1873,7 +1875,18 @@
 	}
 
 	// See if something overrides the line background color.
-	const ColourOptional background = vsDraw.Background(model.pdoc->GetMark(line), model.caret.active, ll->containsCaret);
+	ColourOptional background = vsDraw.Background(model.pdoc->GetMark(line), model.caret.active, ll->containsCaret);
+	SCNotification scn = { 0 };
+	scn.nmhdr.code = SCN_GETBKCOLOR;
+	scn.line = line;
+	scn.lParam = -1;
+	if (editor)
+		((Editor*)editor)->NotifyParent(&scn);
+	if (scn.lParam != -1)
+	{
+		background.Set(scn.lParam);
+		background.isSet = true;
+	}
 
 	const Sci::Position posLineStart = static_cast<Sci::Position>(model.pdoc->LineStart(line));
 
Index: src/EditView.h
===================================================================
--- src/EditView.h	(revision 28084)
+++ src/EditView.h	(working copy)
@@ -75,6 +75,7 @@
 	std::unique_ptr<Surface> pixmapLine;
 	std::unique_ptr<Surface> pixmapIndentGuide;
 	std::unique_ptr<Surface> pixmapIndentGuideHighlight;
+	void	*editor;
 
 	LineLayoutCache llc;
 	PositionCache posCache;
Index: win32/ScintillaWin.cxx
===================================================================
--- win32/ScintillaWin.cxx	(revision 28084)
+++ win32/ScintillaWin.cxx	(working copy)
@@ -345,6 +345,7 @@
 	void SetCtrlID(int identifier) override;
 	int GetCtrlID() override;
 	void NotifyParent(SCNotification scn) override;
+	virtual void NotifyParent(SCNotification * scn);
 	void NotifyDoubleClick(Point pt, int modifiers) override;
 	CaseFolder *CaseFolderForEncoding() override;
 	std::string CaseMapString(const std::string &s, int caseMapping) override;
@@ -1986,6 +1987,13 @@
 	              GetCtrlID(), reinterpret_cast<LPARAM>(&scn));
 }
 
+void ScintillaWin::NotifyParent(SCNotification * scn) {
+	scn->nmhdr.hwndFrom = MainHWND();
+	scn->nmhdr.idFrom = GetCtrlID();
+	::SendMessage(::GetParent(MainHWND()), WM_NOTIFY,
+		GetCtrlID(), reinterpret_cast<LPARAM>(scn));
+}
+
 void ScintillaWin::NotifyDoubleClick(Point pt, int modifiers) {
 	//Platform::DebugPrintf("ScintillaWin Double click 0\n");
 	ScintillaBase::NotifyDoubleClick(pt, modifiers);
